{% extends "base.html" %}

{% block content %}
    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –±–ª–æ–∫ -->
    <div class="row mb-5">
        <div class="col-lg-8 mx-auto text-center">
            <h1 class="display-5 fw-bold">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —É–º–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É!</h1>
            <p class="lead mb-4">
                –≠—Ç–æ –¥–µ–º–æ-–ø—Ä–æ–µ–∫—Ç –¥–ª—è –æ–±—É—á–µ–Ω–∏—è FullStack —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–Ω–∏–≥–∞–º–∏, 
                –∞ –ò–ò-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–æ—Ä –ø–æ–¥–±–µ—Ä—ë—Ç –∫–Ω–∏–≥—É –ø–æ –≤–∞—à–µ–º—É –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é.
            </p>
            <div class="d-flex justify-content-center gap-3">
                <a href="#add-book" class="btn btn-primary btn-lg">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</a>
                <a href="#recommender" class="btn btn-outline-primary btn-lg">ü§ñ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–æ—Ä</a>
            </div>
        </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è: –£–º–Ω—ã–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å (—Ç–µ–ø–µ—Ä—å —Å —è–∫–æ—Ä—ë–º #recommender) -->
    <div class="card shadow-lg mb-5 border-primary" id="recommender">
        <div class="card-body">
            <h2 class="card-title text-primary mb-4">ü§ñ –£–º–Ω—ã–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å –∫–Ω–∏–≥</h2>
            <p class="card-text">–û–ø–∏—à–∏—Ç–µ –≤–∞—à–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–ª–∏ —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ—á–∏—Ç–∞—Ç—å, –∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–±–µ—Ä—ë—Ç –∫–Ω–∏–≥—É.</p>
            
            <form action="/recommend" method="POST" class="row g-2 align-items-end">
                <div class="col-md-9">
                    <label for="user_query" class="form-label">–í–∞—à –∑–∞–ø—Ä–æ—Å</label>
                    <input type="text" class="form-control form-control-lg" id="user_query" name="user_query"
                           value="{{ user_query if user_query else '' }}"
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: '–º–Ω–µ –≥—Ä—É—Å—Ç–Ω–æ', '—Ö–æ—á—É –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π', '–∏—â—É –º–æ—Ç–∏–≤–∞—Ü–∏—é'">
                </div>
                <div class="col-md-3">
                    <button type="submit" class="btn btn-primary btn-lg w-100">–ü–æ–¥–æ–±—Ä–∞—Ç—å –∫–Ω–∏–≥—É</button>
                </div>
            </form>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
            {% if recommended_book %}
            <div class="alert alert-success mt-4 animate__animated animate__fadeIn" role="alert">
                <h4 class="alert-heading">üìñ –î–ª—è –≤–∞—Å –ø–æ–¥–æ–±—Ä–∞–Ω–∞ –∫–Ω–∏–≥–∞:</h4>
                <hr>
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h3 class="mb-2">"{{ recommended_book.title }}"</h3>
                        <p class="mb-1"><strong>–ê–≤—Ç–æ—Ä:</strong> {{ recommended_book.author }}</p>
                        <p class="mb-2"><strong>–ö–ª—é—á–µ–≤—ã–µ —Ç–µ–≥–∏:</strong> 
                            {% for tag in recommended_book.tags %}
                                <span class="badge bg-secondary me-1">{{ tag }}</span>
                            {% endfor %}
                        </p>
                        <p class="mb-0"><small>–ù–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞: "<em>{{ user_query }}</em>"</small></p>
                    </div>
                    <div class="col-md-4 text-end">
                        <button class="btn btn-outline-success" onclick="addToFavorites({{ recommended_book.id }})">
                            ‚ô• –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                        </button>
                    </div>
                </div>
            </div>
            {% elif user_query and user_query|length > 0 %}
            <div class="alert alert-warning mt-4" role="alert">
                –ü–æ –∑–∞–ø—Ä–æ—Å—É "<strong>{{ user_query }}</strong>" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Ç–æ—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π. 
                –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–∏–µ —Å–ª–æ–≤–∞ –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –∫–Ω–∏–≥ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É!
            </div>
            {% endif %}
        </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–Ω–∏–≥–∏ (—Ç–µ–ø–µ—Ä—å —Å —è–∫–æ—Ä—ë–º #add-book) -->
    <div class="card shadow-sm mb-5" id="add-book">
        <div class="card-body">
            <h2 class="card-title mb-4">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–Ω–∏–≥—É</h2>
            <form action="/" method="POST">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="title" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ *</label>
                        <input type="text" class="form-control" id="title" name="title" required>
                    </div>
                    <div class="col-md-6">
                        <label for="author" class="form-label">–ê–≤—Ç–æ—Ä *</label>
                        <input type="text" class="form-control" id="author" name="author" required>
                    </div>
                    <div class="col-md-12">
                        <label for="tags" class="form-label">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                        <input type="text" class="form-control" id="tags" name="tags" 
                               placeholder="–ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è, –º–æ—Ç–∏–≤–∞—Ü–∏—è, –∫–ª–∞—Å—Å–∏–∫–∞">
                        <div class="form-text">–£–∫–∞–∂–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, —á—Ç–æ–±—ã –ò–ò –º–æ–≥ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å —ç—Ç—É –∫–Ω–∏–≥—É.</div>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary px-4">–î–æ–±–∞–≤–∏—Ç—å –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è: –í—Å–µ –∫–Ω–∏–≥–∏ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ -->
    <div class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>üìö –í—Å–µ –∫–Ω–∏–≥–∏ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ</h2>
            <span class="badge bg-primary rounded-pill p-2">{{ books|length }} –∫–Ω–∏–≥</span>
        </div>
        
        {% if books %}
        <div class="row">
            {% for book in books %}
            <div class="col-md-6 col-lg-4 col-xl-3 mb-4">
                <div class="card book-card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">{{ book.title }}</h5>
                        <h6 class="card-subtitle mb-3 text-muted">{{ book.author }}</h6>
                        
                        {% if book.tags %}
                        <div class="mt-auto">
                            <p class="card-text">
                                {% for tag in book.tags %}
                                    <span class="badge bg-light text-dark border me-1 mb-1">{{ tag }}</span>
                                {% endfor %}
                            </p>
                        </div>
                        {% endif %}
                        
                        <div class="mt-3 pt-3 border-top">
                            <small class="text-muted">ID: {{ book.id }}</small>
                            <button class="btn btn-sm btn-outline-danger float-end" 
                                    onclick="deleteBook({{ book.id }})">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-5">
            <h4 class="text-muted">üì≠ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—É—Å—Ç–∞</h4>
            <p class="text-muted">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∫–Ω–∏–≥—É, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–æ—Ä–º—É –≤—ã—à–µ!</p>
        </div>
        {% endif %}
    </div>
{% endblock %}

{% block extra_js %}
<script>
// –ü—Ä–æ—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏-–∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
function addToFavorites(bookId) {
    alert('–ö–Ω–∏–≥–∞ ID ' + bookId + ' –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!');
}

function deleteBook(bookId) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É ID ' + bookId + '?')) {
        alert('–ö–Ω–∏–≥–∞ ID ' + bookId + ' —É–¥–∞–ª–µ–Ω–∞ (–≤ –¥–µ–º–æ —ç—Ç–æ —Ç–æ–ª—å–∫–æ –∑–∞–≥–ª—É—à–∫–∞)');
    }
}
</script>
{% endblock %}